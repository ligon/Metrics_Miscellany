#+TITLE: Agent Operations Guide
#+AUTHOR: Metrics Miscellany Maintainers
#+OPTIONS: toc:nil num:nil

* Purpose
This guide spells out the expectations for automated assistants (LLMs, bots, scripts)
working on *Metrics_Miscellany*.  It supplements human-oriented guidance in
=README.org= and =CONTRIBUTING.org= by turning them into checklists that agents can
execute repeatably.

* Scope
- Follow the coding and documentation conventions in [[file:docs/index.org][docs/index.org]] and
  [[file:metrics_miscellany.org][metrics_miscellany.org]].
- Human contributors still review all substantive changes; this document only clarifies
  how agents prepare that work.
- Use =docs/automation/= for run logs or follow-up notes that should persist beyond a
  single session.

* Operating Principles
1. **Preserve semantics** – retain existing estimator APIs, notation, and tangling layout
   when editing Org snippets or Python outputs.
2. **Minimal footprint** – modify only the files required for the task; avoid bulk
   formatting or refactors without explicit approval.
3. **Verifiable output** – accompany code changes with reproducible commands (tests,
   linting, tangling) that maintainers can replay via Poetry.
4. **Transparent reasoning** – document non-obvious design choices in commit messages or
   short Org notes under =docs/automation/=.  Include file references when possible.
5. **Explicit attribution** – add a =Co-authored-by: Assistant (Codex CLI)= trailer (or the
   correct agent tag) to commits produced by automations so history stays clear.
6. **ASCII-safe math** – when editing Org documents, prefer LaTeX commands like
   \mu, \Sigma, and display delimiters \[ ... \]; avoid literal Unicode math glyphs.

* Pre-Execution Checklist
1. Sync the working tree with the target branch (typically =master= or a dedicated feature
   branch) without rewriting history.
2. Review [[file:CONTRIBUTING.org][CONTRIBUTING.org]] and this guide to confirm tooling expectations.
3. Inspect task-specific instructions in =README.org= or issue notes.
4. Confirm sandbox limits (filesystem scope, network policy).  Request maintainer approval
   before running commands that need elevated permissions or network access.

* Tooling & Commands
- Use Poetry for everything: =poetry install=, =poetry run ...=, =poetry build=.
- Prefer Make targets over ad-hoc invocations:
  - =make quick-check= for the default lint/type/test sweep.
  - =make slow-tests= for marked slow cases.
- Stick to fast search utilities (=rg=, =python - <<'PY'= scripts) for inspection; avoid
  destructive commands like =rm -rf= or =git reset --hard=.
- When exporting Org blocks, reuse =tangle.sh= or documented batch =emacs= commands.

* Collaboration Protocol
- **Task intake**: restate the assignment, list target files, flag ambiguities before editing.
- **Status updates**: maintain a short status section in any active automation log.
- **Timestamps**: use active Org timestamps (e.g., =<2025-10-27 Mon>=) in logs to record
  when actions occurred.
- **Handoff**: summarize edits, link to files (`path:line`), and list verification commands.
- **Review support**: provide focused diffs or highlights; do not auto-format untouched files.
- **Quality checks**: unless explicitly excused, run:
  1. =poetry run ruff check .=
  2. =poetry run black --check .=
  3. =poetry run mypy metrics_miscellany test= (after configuration)
  4. =poetry run pytest=

* Incident Response
- If a command fails (permissions, sandbox, missing dependency), stop and document the
  failure along with the proposed workaround before retrying.
- When encountering unexpected repository state (untracked tangles, partial builds), pause
  and request maintainer guidance rather than overwriting files.
- Log any manual rollbacks or file restores in =docs/automation/status_log.org= (or a new
  dated entry).

* Change Log Template
Use the format below when updating this guide or other automation policies:
#+begin_example
** <YYYY-MM-DD Day> Agent/Author Tag
- Summary of changes and affected sections
- Commands or policies updated
#+end_example

* Current Change Log
** <2025-10-27 Mon> Assistant (Codex CLI)
- Initial version tailored to the Metrics_Miscellany workflow.
- Captured Poetry-based tooling, quick-check expectations, and attribution rules for agents.
